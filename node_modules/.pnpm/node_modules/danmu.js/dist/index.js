/* Built @Mon, 27 Oct 2025 03:05:15 GMT */
!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var o in n)("object"==typeof exports?exports:e)[o]=n[o]}}(typeof window!=="undefined"?window:typeof self!=="undefined"?self:typeof globalThis!=="undefined"?globalThis:typeof global!=="undefined"?global:this,function(){return function(){"use strict";var e={"./node_modules/css-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js!./src/style/index.scss":function(e,t,n){var o=n("./node_modules/css-loader/dist/runtime/sourceMaps.js"),i=n.n(o),r=n("./node_modules/css-loader/dist/runtime/api.js"),s=n.n(r)()(i());s.push([e.id,".danmu{overflow:hidden;user-select:none;-ms-user-select:none}.danmu>*{position:absolute;white-space:nowrap}.danmu-switch{width:32px;height:20px;border-radius:100px;background-color:#ccc;box-sizing:border-box;outline:none;cursor:pointer;position:relative;text-align:center;margin:10px auto}.danmu-switch.danmu-switch-active{padding-left:12px;background-color:#f85959}.danmu-switch span.txt{width:20px;height:20px;line-height:20px;text-align:center;display:block;border-radius:100px;background-color:#fff;box-shadow:-2px 0 0 0 rgba(0,0,0,.04);font-family:PingFangSC;font-size:10px;font-weight:500;color:#f44336}","",{version:3,sources:["webpack://./src/style/danmu.scss"],names:[],mappings:"AAAA,OACE,eAAA,CACA,gBAAA,CACA,oBAAA,CACA,SACE,iBAAA,CACA,kBAAA,CAIJ,cACE,UAAA,CACA,WAAA,CACA,mBAAA,CACA,qBAAA,CACA,qBAAA,CACA,YAAA,CACA,cAAA,CACA,iBAAA,CACA,iBAAA,CACA,gBAAA,CACA,kCACE,iBAAA,CACA,wBAAA,CAEF,uBACE,UAAA,CACA,WAAA,CACA,gBAAA,CACA,iBAAA,CACA,aAAA,CACA,mBAAA,CACA,qBAAA,CACA,qCAAA,CACA,sBAAA,CACA,cAAA,CACA,eAAA,CACA,aAAA",sourcesContent:[".danmu {\n  overflow: hidden;\n  user-select: none;\n  -ms-user-select: none;\n  > * {\n    position: absolute;\n    white-space: nowrap;\n  }\n}\n\n.danmu-switch {\n  width: 32px;\n  height: 20px;\n  border-radius: 100px;\n  background-color: #ccc;\n  box-sizing: border-box;\n  outline: none;\n  cursor: pointer;\n  position: relative;\n  text-align: center;\n  margin: 10px auto;\n  &.danmu-switch-active {\n    padding-left: 12px;\n    background-color: #f85959;\n  }\n  span.txt {\n    width: 20px;\n    height: 20px;\n    line-height: 20px;\n    text-align: center;\n    display: block;\n    border-radius: 100px;\n    background-color: #ffffff;\n    box-shadow: -2px 0 0 0 rgba(0, 0, 0, 0.04);\n    font-family: PingFangSC;\n    font-size: 10px;\n    font-weight: 500;\n    color: #f44336;\n  }\n}\n"],sourceRoot:""}]),t.A=s},"./node_modules/css-loader/dist/runtime/api.js":function(e){e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var n="",o=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),o&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),o&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n}).join("")},t.i=function(e,n,o,i,r){"string"==typeof e&&(e=[[null,e,void 0]]);var s={};if(o)for(var a=0;a<this.length;a++){var l=this[a][0];null!=l&&(s[l]=!0)}for(var c=0;c<e.length;c++){var u=[].concat(e[c]);o&&s[u[0]]||(void 0!==r&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=r),n&&(u[2]&&(u[1]="@media ".concat(u[2]," {").concat(u[1],"}")),u[2]=n),i&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=i):u[4]="".concat(i)),t.push(u))}},t}},"./node_modules/css-loader/dist/runtime/sourceMaps.js":function(e){e.exports=function(e){var t=e[1],n=e[3];if(!n)return t;if("function"==typeof btoa){var o=btoa(unescape(encodeURIComponent(JSON.stringify(n))));return[t].concat(["/*# ".concat("sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(o)," */")]).join("\n")}return[t].join("\n")}},"./node_modules/d/index.js":function(e,t,n){var o=n("./node_modules/d/node_modules/type/value/is.js"),i=n("./node_modules/d/node_modules/type/plain-function/is.js"),r=n("./node_modules/es5-ext/object/assign/index.js"),s=n("./node_modules/es5-ext/object/normalize-options.js"),a=n("./node_modules/es5-ext/string/​#/contains/index.js");(e.exports=function(e,t){var n,i,l,c,u;return arguments.length<2||"string"!=typeof e?(c=t,t=e,e=null):c=arguments[2],o(e)?(n=a.call(e,"c"),i=a.call(e,"e"),l=a.call(e,"w")):(n=l=!0,i=!1),u={value:t,configurable:n,enumerable:i,writable:l},c?r(s(c),u):u}).gs=function(e,t,n){var l,c,u,h;return"string"!=typeof e?(u=n,n=t,t=e,e=null):u=arguments[3],o(t)?i(t)?o(n)?i(n)||(u=n,n=void 0):n=void 0:(u=t,t=n=void 0):t=void 0,o(e)?(l=a.call(e,"c"),c=a.call(e,"e")):(l=!0,c=!1),h={get:t,set:n,configurable:l,enumerable:c},u?r(s(u),h):h}},"./node_modules/d/node_modules/type/function/is.js":function(e,t,n){var o=n("./node_modules/d/node_modules/type/prototype/is.js");e.exports=function(e){if("function"!=typeof e||!hasOwnProperty.call(e,"length"))return!1;try{if("number"!=typeof e.length||"function"!=typeof e.call||"function"!=typeof e.apply)return!1}catch(e){return!1}return!o(e)}},"./node_modules/d/node_modules/type/object/is.js":function(e,t,n){var o=n("./node_modules/d/node_modules/type/value/is.js"),i={object:!0,function:!0,undefined:!0};e.exports=function(e){return!!o(e)&&hasOwnProperty.call(i,typeof e)}},"./node_modules/d/node_modules/type/plain-function/is.js":function(e,t,n){var o=n("./node_modules/d/node_modules/type/function/is.js"),i=/^\s*class[\s{/}]/,r=Function.prototype.toString;e.exports=function(e){return!(!o(e)||i.test(r.call(e)))}},"./node_modules/d/node_modules/type/prototype/is.js":function(e,t,n){var o=n("./node_modules/d/node_modules/type/object/is.js");e.exports=function(e){if(!o(e))return!1;try{if(!e.constructor)return!1;return e.constructor.prototype===e}catch(e){return!1}}},"./node_modules/d/node_modules/type/value/is.js":function(e){var t=void 0;e.exports=function(e){return e!==t&&null!==e}},"./node_modules/es5-ext/function/noop.js":function(e){e.exports=function(){}},"./node_modules/es5-ext/object/assign/index.js":function(e,t,n){e.exports=n("./node_modules/es5-ext/object/assign/is-implemented.js")()?Object.assign:n("./node_modules/es5-ext/object/assign/shim.js")},"./node_modules/es5-ext/object/assign/is-implemented.js":function(e){e.exports=function(){var e,t=Object.assign;return"function"==typeof t&&(t(e={foo:"raz"},{bar:"dwa"},{trzy:"trzy"}),e.foo+e.bar+e.trzy==="razdwatrzy")}},"./node_modules/es5-ext/object/assign/shim.js":function(e,t,n){var o=n("./node_modules/es5-ext/object/keys/index.js"),i=n("./node_modules/es5-ext/object/valid-value.js"),r=Math.max;e.exports=function(e,t){var n,s,a,l=r(arguments.length,2);for(s=1,e=Object(i(e)),a=function(o){try{e[o]=t[o]}catch(e){n||(n=e)}};s<l;++s)t=arguments[s],o(t).forEach(a);if(void 0!==n)throw n;return e}},"./node_modules/es5-ext/object/is-value.js":function(e,t,n){var o=n("./node_modules/es5-ext/function/noop.js")();e.exports=function(e){return e!==o&&null!==e}},"./node_modules/es5-ext/object/keys/index.js":function(e,t,n){e.exports=n("./node_modules/es5-ext/object/keys/is-implemented.js")()?Object.keys:n("./node_modules/es5-ext/object/keys/shim.js")},"./node_modules/es5-ext/object/keys/is-implemented.js":function(e){e.exports=function(){try{return Object.keys("primitive"),!0}catch(e){return!1}}},"./node_modules/es5-ext/object/keys/shim.js":function(e,t,n){var o=n("./node_modules/es5-ext/object/is-value.js"),i=Object.keys;e.exports=function(e){return i(o(e)?Object(e):e)}},"./node_modules/es5-ext/object/normalize-options.js":function(e,t,n){var o=n("./node_modules/es5-ext/object/is-value.js"),i=Array.prototype.forEach,r=Object.create,s=function(e,t){var n;for(n in e)t[n]=e[n]};e.exports=function(e){var t=r(null);return i.call(arguments,function(e){o(e)&&s(Object(e),t)}),t}},"./node_modules/es5-ext/object/valid-callable.js":function(e){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function");return e}},"./node_modules/es5-ext/object/valid-value.js":function(e,t,n){var o=n("./node_modules/es5-ext/object/is-value.js");e.exports=function(e){if(!o(e))throw TypeError("Cannot use null or undefined");return e}},"./node_modules/es5-ext/string/​#/contains/index.js":function(e,t,n){e.exports=n("./node_modules/es5-ext/string/​#/contains/is-implemented.js")()?String.prototype.contains:n("./node_modules/es5-ext/string/​#/contains/shim.js")},"./node_modules/es5-ext/string/​#/contains/is-implemented.js":function(e){var t="razdwatrzy";e.exports=function(){return"function"==typeof t.contains&&!0===t.contains("dwa")&&!1===t.contains("foo")}},"./node_modules/es5-ext/string/​#/contains/shim.js":function(e){var t=String.prototype.indexOf;e.exports=function(e){return t.call(this,e,arguments[1])>-1}},"./node_modules/event-emitter/index.js":function(e,t,n){var o,i,r,s,a,l,c,u=n("./node_modules/d/index.js"),h=n("./node_modules/es5-ext/object/valid-callable.js"),f=Function.prototype.apply,d=Function.prototype.call,m=Object.create,p=Object.defineProperty,g=Object.defineProperties,v=Object.prototype.hasOwnProperty,y={configurable:!0,enumerable:!1,writable:!0};o=function(e,t){var n;return h(t),v.call(this,"__ee__")?n=this.__ee__:(n=y.value=m(null),p(this,"__ee__",y),y.value=null),n[e]?"object"==typeof n[e]?n[e].push(t):n[e]=[n[e],t]:n[e]=t,this},i=function(e,t){var n,i;return h(t),i=this,o.call(this,e,n=function(){r.call(i,e,n),f.call(t,this,arguments)}),n.__eeOnceListener__=t,this},a={on:o,once:i,off:r=function(e,t){var n,o,i,r;if(h(t),!v.call(this,"__ee__")||!(n=this.__ee__)[e])return this;if("object"==typeof(o=n[e]))for(r=0;i=o[r];++r)(i===t||i.__eeOnceListener__===t)&&(2===o.length?n[e]=o[+!r]:o.splice(r,1));else(o===t||o.__eeOnceListener__===t)&&delete n[e];return this},emit:s=function(e){var t,n,o,i,r;if(v.call(this,"__ee__")&&(i=this.__ee__[e]))if("object"==typeof i){for(t=1,n=arguments.length,r=Array(n-1);t<n;++t)r[t-1]=arguments[t];for(t=0,i=i.slice();o=i[t];++t)f.call(o,this,r)}else switch(arguments.length){case 1:d.call(i,this);break;case 2:d.call(i,this,arguments[1]);break;case 3:d.call(i,this,arguments[1],arguments[2]);break;default:for(t=1,n=arguments.length,r=Array(n-1);t<n;++t)r[t-1]=arguments[t];f.call(i,this,r)}}},c=g({},l={on:u(o),once:u(i),off:u(r),emit:u(s)}),e.exports=t=function(e){return null==e?m(c):g(Object(e),l)},t.methods=a},"./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js":function(e){var t=[];function n(e){for(var n=-1,o=0;o<t.length;o++)if(t[o].identifier===e){n=o;break}return n}function o(e,o){for(var i={},r=[],s=0;s<e.length;s++){var a=e[s],l=o.base?a[0]+o.base:a[0],c=i[l]||0,u="".concat(l," ").concat(c);i[l]=c+1;var h=n(u),f={css:a[1],media:a[2],sourceMap:a[3],supports:a[4],layer:a[5]};if(-1!==h)t[h].references++,t[h].updater(f);else{var d=function(e,t){var n=t.domAPI(t);return n.update(e),function(t){t?(t.css!==e.css||t.media!==e.media||t.sourceMap!==e.sourceMap||t.supports!==e.supports||t.layer!==e.layer)&&n.update(e=t):n.remove()}}(f,o);o.byIndex=s,t.splice(s,0,{identifier:u,updater:d,references:1})}r.push(u)}return r}e.exports=function(e,i){var r=o(e=e||[],i=i||{});return function(e){e=e||[];for(var s=0;s<r.length;s++){var a=n(r[s]);t[a].references--}for(var l=o(e,i),c=0;c<r.length;c++){var u=n(r[c]);0===t[u].references&&(t[u].updater(),t.splice(u,1))}r=l}}},"./node_modules/style-loader/dist/runtime/insertBySelector.js":function(e){var t={};e.exports=function(e,n){var o=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!o)throw Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(n)}},"./node_modules/style-loader/dist/runtime/insertStyleElement.js":function(e){e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},"./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js":function(e,t,n){e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},"./node_modules/style-loader/dist/runtime/styleDomAPI.js":function(e){e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){var o,i,r;o="",n.supports&&(o+="@supports (".concat(n.supports,") {")),n.media&&(o+="@media ".concat(n.media," {")),(i=void 0!==n.layer)&&(o+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),o+=n.css,i&&(o+="}"),n.media&&(o+="}"),n.supports&&(o+="}"),(r=n.sourceMap)&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),e.styleTagTransform(o,t,e.options)},remove:function(){var e;null===(e=t).parentNode||e.parentNode.removeChild(e)}}}},"./node_modules/style-loader/dist/runtime/styleTagTransform.js":function(e){e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}}},t={};function n(o){var i=t[o];if(void 0!==i)return i.exports;var r=t[o]={id:o,exports:{}};return e[o](r,r.exports,n),r.exports}n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nc=void 0;var o={};return!function(){n.r(o),n.d(o,{default:function(){return B},DanmuJs:function(){return B}});var e=n("./node_modules/event-emitter/index.js"),t=n.n(e);function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}var r="undefined"!=typeof window&&window.location.href.indexOf("danmu-debug")>-1,s=function(){var e;function t(e){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");this.constructorName=e||""}return e=[{key:"info",value:function(e){for(var t,n=arguments.length,o=Array(n>1?n-1:0),s=1;s<n;s++)o[s-1]=arguments[s];r&&(t=console).log.apply(t,["[Danmu Log][".concat(this.constructorName,"]"),e].concat(function(e){if(Array.isArray(e))return i(e)}(o)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(o)||function(e,t){if(e){if("string"==typeof e)return i(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,void 0)}}(o)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()))}}],function(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}(t.prototype,e),t}(),a=function(){var e;function t(){if(!(this instanceof t))throw TypeError("Cannot call a class as a function")}return e=[{key:"setLogger",value:function(e){this.logger=(null!=s&&"undefined"!=typeof Symbol&&s[Symbol.hasInstance]?!!s[Symbol.hasInstance](e):e instanceof s)?e:new s((e||"")+".js")}}],function(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}(t.prototype,e),t}(),l=Object.prototype.hasOwnProperty;function c(e,t){if("Object"===u(t)&&"Object"===u(e))return Object.keys(t).forEach(function(n){var o,i;"Object"!==u(t[n])||(o=t[n],null!=(i=Node)&&"undefined"!=typeof Symbol&&i[Symbol.hasInstance]?!!i[Symbol.hasInstance](o):o instanceof i)?"Array"===u(t[n])?e[n]="Array"===u(e[n])?e[n].concat(t[n]):t[n]:e[n]=t[n]:e[n]?c(e[n],t[n]):e[n]=t[n]}),e}function u(e){return Object.prototype.toString.call(e).match(/([^\s.*]+)(?=]$)/g)[0]}function h(e,t,n,o){if(o)e.on(t,n),e.once(o,function i(){e.off(t,n),e.off(o,i)});else{var i=function(o){n(o),e.off(t,i)};e.on(t,i)}}function f(e,t,n){var o=e.style;try{o[t]=n}catch(e){o.setProperty(t,n)}}function d(e){return"number"==typeof e&&!Number.isNaN(e)}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function g(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(g=function(){return!!e})()}var v=new s("bullet"),y=function(e){var t;if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");function n(e){var t,o,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!(this instanceof n))throw TypeError("Cannot call a class as a function");t=m(t=n),o=function(e,t){var n;if(t&&("object"==((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)||"function"==typeof t))return t;if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,g()?Reflect.construct(t,[],m(this).constructor):t.apply(this,void 0));var r=e.container,s=e.recycler,a=e.config;return o.setLogger(v),o.danmu=e,o.options=i,o.duration=i.duration,o.id=i.id,o.container=r,o.mode="top"===i.mode||"bottom"===i.mode?i.mode:"scroll",o.start=i.start,o.prior=i.prior,o.realTime=i.realTime,o.color=i.color,o.bookChannelId=i.bookChannelId,o.reuseDOM=!0,o.noCopyEl=!!(a.disableCopyDOM||i.disableCopyDOM),o.recycler=s,o._fullySlideInScreenDuration=void 0,o._lastMoveTime=void 0,o.status="waiting",i.elLazyInit||(o.bulletCreateFail=!o._makeEl()),o}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),e&&p(n,e),t=[{key:"moveV",get:function(){var e=this.danmu,t=this.options,n=this._moveV;if(!n){if(t.moveV)n=t.moveV;else if(this.elPos){var o=e.containerPos;n=("b2t"===this.direction?o.height+(e.config.chaseEffect?this.height:0):o.width+(e.config.chaseEffect?this.width:0))/this.duration*1e3}n&&(n*=e.main.playRate,this._moveV=n)}return n}},{key:"direction",get:function(){return this.danmu.direction}},{key:"fullySlideIntoScreen",get:function(){var e=!0;return"scroll"===this.mode&&this._lastMoveTime&&this._fullySlideInScreenDuration>0&&(e=(new Date().getTime()-this._lastMoveTime)/1e3>=this._fullySlideInScreenDuration),e}},{key:"_makeEl",value:function(){var e,t,n=this.danmu,o=this.options,i=n.config,r=n.globalHooks,s="",a=o.style||{};if(a.perspective="500em",o.el||o.elLazyInit){if(this.noCopyEl&&(this.reuseDOM=!1),o.elLazyInit){if("function"==typeof r.bulletCreateEl)try{var l,c=r.bulletCreateEl(o);l=HTMLElement,e=(null!=l&&"undefined"!=typeof Symbol&&l[Symbol.hasInstance]?!!l[Symbol.hasInstance](c):c instanceof l)?c:c.el}catch(e){}}else if(1===o.el.nodeType&&!o.el.parentNode)if(this.reuseDOM){var u=function(e){if(!e||1!==e.nodeType)return"";var t=document.createElement(e.tagName);return Array.prototype.forEach.call(e.attributes,function(e){t.setAttribute(e.name,e.value)}),e.innerHTML&&(t.innerHTML=e.innerHTML),t}(o.el);o.eventListeners&&o.eventListeners.length>0&&o.eventListeners.forEach(function(e){u.addEventListener(e.event,e.listener,e.useCapture||!1)}),(e=this.recycler.use()).childNodes.length>0&&(e.innerHTML=""),e.textContent&&(e.textContent=""),e.appendChild(u)}else e=o.el}else"string"==typeof o.txt&&((e=this.recycler.use()).textContent=o.txt);if(!e||!n.main)return!1;if(d(i.bulletOffset)&&i.bulletOffset>=0)t=i.bulletOffset;else{var h=n.containerPos;t=h.width/10>100?100:h.width/10}var f=o.realTime?0:Math.floor(Math.random()*t);a.left=this.updateOffset(f,!0),Object.keys(a).forEach(function(e){var t=e.replace(/[A-Z]/g,function(e){return"-"+e.toLowerCase()});s+="".concat(t,":").concat(a[e],";")});var m=s,p=e.style;try{p.cssText=m}catch(e){}return this.el=e,o.like&&o.like.el&&this.setLikeDom(o.like.el,o.like.style),!0}},{key:"updateOffset",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.random=e;var n=this.danmu.containerPos.width+e+"px";return t||f(this.el,"left",this.danmu.containerPos.width+e+"px"),n}},{key:"attach",value:function(){if(this.options.elLazyInit&&!this.el&&this._makeEl(),this.danmu&&this.danmu.main){var e=this.danmu,t=this.options,n=this.el,o=e.globalHooks;o.bulletAttaching&&o.bulletAttaching(t),this.container.contains(n)||this.container.appendChild(n),this.elPos=n.getBoundingClientRect(),"b2t"===this.direction?(this.width=this.elPos.height,this.height=this.elPos.width):(this.width=this.elPos.width,this.height=this.elPos.height),this.moveV&&(this.duration=(this.danmu.containerPos.width+this.random+this.width)/this.moveV*1e3),o.bulletAttached&&o.bulletAttached(t,n)}}},{key:"detach",value:function(){var e=this.el,t=this.danmu,n=this.options,o=t.globalHooks;e&&(o.bulletDetaching&&o.bulletDetaching(n),this.reuseDOM?this.recycler.unused(e):e.parentNode&&e.parentNode.removeChild(e),o.bulletDetached&&o.bulletDetached(n,e),this.el=null),this.elPos=void 0}},{key:"topInit",value:function(){this.logger&&this.logger.info("topInit #".concat(this.options.txt||"[DOM Element]","#")),"b2t"===this.direction?(f(this.el,"transformOrigin","left top"),f(this.el,"transform","translateX(-".concat(this.top,"px) translateY(").concat(this.danmu.containerPos.height,"px) translateZ(0px) rotate(90deg)")),f(this.el,"transition","transform 0s linear 0s")):f(this.el,"top","".concat(this.top,"px"))}},{key:"pauseMove",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if("paused"!==this.status&&("forcedPause"!==this.status&&(this.status="paused"),this._moveV=void 0,this.el))if("scroll"===this.mode){var t=this.danmu.containerPos;if(e){var n=(new Date().getTime()-this._lastMoveTime)/1e3*this.moveV,o=0;o=this.moveMoreS-n>=0?"b2t"===this.direction?(this.moveMoreS-n)/this.moveContainerHeight*t.height:(this.moveMoreS-n)/this.moveContainerWidth*t.width:this.moveMoreS-n,"b2t"===this.direction?f(this.el,"transform","translateX(-".concat(this.top,"px) translateY(").concat(o,"px) translateZ(0px) rotate(90deg)")):f(this.el,"left","".concat(o,"px"))}else"b2t"===this.direction?f(this.el,"transform","translateX(-".concat(this.top,"px) translateY(").concat(this.el.getBoundingClientRect().top-t.top,"px) translateZ(0px) rotate(90deg)")):f(this.el,"left","".concat(this.el.getBoundingClientRect().left-t.left,"px"));"b2t"===this.direction||f(this.el,"transform","translateX(0px) translateY(0px) translateZ(0px)"),f(this.el,"transition","transform 0s linear 0s")}else this.pastDuration&&this.startTime?this.pastDuration=this.pastDuration+new Date().getTime()-this.startTime:this.pastDuration=1}},{key:"startMove",value:function(e){if((this.hasMove||(this.danmu.emit("bullet_start",this),this.hasMove=!0),("forcedPause"!==this.status||e)&&this.el)&&"start"!==this.status)if(this.status="start","scroll"===this.mode){var t,n=this.danmu.containerPos;if(!this.el)return;var o=this.el.getBoundingClientRect();if("b2t"===this.direction){t=o.bottom-n.bottom;var i=(o.bottom-n.top)/this.moveV;f(this.el,"transition","transform ".concat(i,"s linear 0s")),f(this.el,"transform","translateX(-".concat(this.top,"px) translateY(-").concat(this.height,"px) translateZ(0px) rotate(90deg)")),this._lastMoveTime=new Date().getTime(),this.moveMoreS=o.top-n.top,this.moveContainerHeight=n.height}else{t=o.right-n.right;var r=o.right-n.left,s=r/this.moveV;o.right>n.left?(f(this.el,"transition","transform ".concat(s,"s linear 0s")),f(this.el,"transform","translateX(-".concat(r,"px) translateY(0px) translateZ(0px)")),this._lastMoveTime=new Date().getTime(),this.moveMoreS=o.left-n.left,this.moveContainerWidth=n.width):(this.status="end",this.remove())}this._fullySlideInScreenDuration=t/this.moveV}else{var a=new Date().getTime(),l=(this.startTime&&a-this.startTime>this.duration?a-this.startTime:this.duration)/1e3;f(this.el,"left","50%"),f(this.el,"margin","0 0 0 -".concat(this.width/2,"px")),f(this.el,"visibility","hidden"),f(this.el,"transition","visibility ".concat(l,"s 0s")),this.pastDuration||(this.pastDuration=1),this.startTime=a}}},{key:"remove",value:function(){var e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];this.logger&&this.logger.info("remove #".concat(this.options.txt||"[DOM Element]","#")),e&&this.pauseMove(),this.el&&this.el.parentNode&&(this.detach(),this.options.el&&1===this.options.el.nodeType&&this.noCopyEl&&f(this.options.el,"transform","none"),this.danmu.emit("bullet_remove",{bullet:this}))}},{key:"setFontSize",value:function(e){this.el&&(this.el.style.fontSize=e)}},{key:"setLikeDom",value:function(e,t){if(e){Object.keys(t).forEach(function(n){e.style[n]=t[n]});var n="danmu-like";if(e.className=n,this.el){var o=this.el.querySelector("."+n);o&&this.el.removeChild(o),this.el.innerHTML="".concat(this.el.innerHTML).concat(e.outerHTML)}}return e}}],function(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}(n.prototype,t),n}(a);function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _(e,t){return(_=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function A(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(A=function(){return!!e})()}var k=function(e){var t;if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");function n(e){var t,o;if(!(this instanceof n))throw TypeError("Cannot call a class as a function");return t=b(t=n),(o=function(e,t){var n;if(t&&("object"==((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)||"function"==typeof t))return t;if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,A()?Reflect.construct(t,[],b(this).constructor):t.apply(this,void 0))).setLogger("channel"),o.danmu=e,o.width=0,o.height=0,o.reset(!0),o.channels=[],o.updatePos(),h(o.danmu,"bullet_remove",function(e){o.removeBullet(e.bullet)},"destroy"),h(o.danmu,"channel_resize",function(){o.resize()},"destroy"),o}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),e&&_(n,e),t=[{key:"direction",get:function(){return this.danmu.direction}},{key:"checkAvailableTrack",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"scroll",t=this.channels,n=!1;if("scroll"===e)for(var o,i=0;i<t.length;i++){if(o=t[i],n=!0,o.operating[e]){n=!1;continue}var r=o.queue[e][0];if(r&&!r.fullySlideIntoScreen){n=!1;continue}if(n)break}else n=!0;return n}},{key:"destroy",value:function(){for(var e in this.logger&&this.logger.info("destroy"),this.channels.splice(0,this.channels.length),this._cancelResizeTimer(),this)l.call(this,e)&&delete this[e]}},{key:"reset",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.logger&&this.logger.info("reset");var t=this,n=t.danmu,o=n.container,i=n.bulletBtn;function r(){if(t.danmu&&t.danmu.container){var e=t.danmu.container.getBoundingClientRect();t.width=e.width,t.height=e.height,t.resetId&&(cancelAnimationFrame(t.resetId),t.resetId=null);var n=t._initChannels(),o=n.channelSize,i=n.channelCount,r=n.channels;t.channelCount=i,t.channels=r,"b2t"===t.direction?t.channelWidth=o:t.channelHeight=o}}t.container=o,i&&i.main&&i.main.queue.forEach(function(e){e.remove()}),t.channels&&t.channels.length>0&&["scroll","top","bottom"].forEach(function(e){for(var n=0;n<t.channels.length;n++)t.channels[n].queue[e].forEach(function(e){e.remove()})}),i&&i.main&&i.main.data&&i.main.data.forEach(function(e){e.attached_=!1}),e?this.resetId=requestAnimationFrame(r):r()}},{key:"getRealOccupyArea",value:function(){return{width:this.width,height:this.height}}},{key:"updatePos",value:function(){var e=this.container.getBoundingClientRect();this.containerPos=e,this.containerWidth=e.width,this.containerHeight=e.height,this.containerTop=e.top,this.containerBottom=e.bottom,this.containerLeft=e.left,this.containerRight=e.right}},{key:"addBullet",value:function(e){var t=this,n=this.danmu,o=this.channels;if("b2t"===t.direction?(r=this.channelWidth,s=Math.ceil(e.width/r)):(i=this.channelHeight,s=Math.ceil(e.height/i)),s>o.length)return{result:!1,message:"exceed channels.length, occupy=".concat(s,",channelsSize=").concat(o.length)};for(var i,r,s,a,l=!0,c=-1,u=0,h=o.length;u<h;u++)if(o[u].queue[e.mode].some(function(t){return t.id===e.id}))return{result:!1,message:"exited, channelOrder=".concat(u,",danmu_id=").concat(e.id)};if("scroll"===e.mode)for(var f=0,d=o.length-s;f<=d;f+=s){l=!0;for(var m=f;m<f+s;m++){if((a=o[m]).operating.scroll||a.bookId.scroll&&a.bookId.scroll!==e.id){l=!1;break}a.operating.scroll=!0;var p=a.queue.scroll[0];if(p){var g=p.el.getBoundingClientRect();if("b2t"===t.direction){if(g.bottom>=t.containerPos.bottom){l=!1,a.operating.scroll=!1;break}}else if(g.right>=t.containerPos.right){l=!1,a.operating.scroll=!1;break}var v=void 0,y=p.moveV,b=void 0,_=e.moveV,A=void 0;if("b2t"===t.direction?(b=(v=g.bottom-t.containerTop)/y,A=t.containerHeight+e.random-v):(b=(v=g.right-t.containerLeft)/y,A=t.containerWidth+e.random-v),_>y){var k=A/(_-y);if(n.config.bOffset||(n.config.bOffset=0),b+n.config.bOffset>=k){var x=b*_-t.containerPos.width;x>0&&e.updateOffset(x+(1+Math.ceil(5*Math.random())))}}}a.operating.scroll=!1}if(l){c=f;break}}else if("top"===e.mode)for(var j=0,C=o.length-s;j<=C;j++){l=!0;for(var O=j;O<j+s;O++){if(O>Math.floor(o.length/2)||(a=o[O]).operating[e.mode]||(a.bookId[e.mode]||e.prior)&&a.bookId[e.mode]!==e.id){l=!1;break}if(a.operating[e.mode]=!0,a.queue[e.mode].length>0){l=!1,a.operating[e.mode]=!1;break}a.operating[e.mode]=!1}if(l){c=j;break}}else if("bottom"===e.mode)for(var w=o.length-s;w>=0;w--){l=!0;for(var S=w;S<w+s;S++){if(S<=Math.floor(o.length/2)||(a=o[S]).operating[e.mode]||(a.bookId[e.mode]||e.prior)&&a.bookId[e.mode]!==e.id){l=!1;break}if(a.operating[e.mode]=!0,a.queue[e.mode].length>0){l=!1,a.operating[e.mode]=!1;break}a.operating[e.mode]=!1}if(l){c=w;break}}if(-1!==c){for(var E=c,T=c+s;E<T;E++)(a=o[E]).operating[e.mode]=!0,a.queue[e.mode].unshift(e),e.prior&&(delete a.bookId[e.mode],t.logger&&t.logger.info(E+"号轨道恢复正常使用")),a.operating[e.mode]=!1;return e.prior&&(t.logger&&t.logger.info(e.id+"号优先弹幕运行完毕"),delete e.bookChannelId,n.player&&n.bulletBtn.main.data.some(function(t){return t.id===e.id&&(delete t.bookChannelId,!0)})),e.channel_id=[c,s],e.el.setAttribute("data-line-index",c+1),"b2t"===t.direction?(e.top=c*r,t.danmu.config.area&&t.danmu.config.area.start&&(e.top+=t.containerWidth*t.danmu.config.area.start)):(e.top=c*i,t.danmu.config.area&&t.danmu.config.area.start&&(e.top+=t.containerHeight*t.danmu.config.area.start)),{result:e,message:"success"}}if(e.options.realTime){var z=0,M=-1,P=null;if(t.danmu.bulletBtn.main.queue.forEach(function(e,n){!e.prior&&!e.options.realTime&&e.el&&e.el.getBoundingClientRect().left>t.containerPos.right&&e.start>=z&&(z=e.start,M=n,P=e)}),P){P.remove(),t.removeBullet(P),t.danmu.bulletBtn.main.queue.splice(M,1),e.channel_id=P.channel_id;for(var I=P.channel_id[0],L=P.channel_id[0]+P.channel_id[1];I<L;I++)(a=o[I]).operating[e.mode]=!0,a.queue[e.mode].unshift(e),e.prior&&delete a.bookId[e.mode],a.operating[e.mode]=!1;return e.top=P.top,t.danmu.config.area&&t.danmu.config.area.start&&(e.top+=t.containerHeight*t.danmu.config.area.start),{result:e,message:"success"}}}if(e.prior)if(e.bookChannelId||t.danmu.live)n.player&&n.bulletBtn.main.data.some(function(n){return n.id===e.id&&(t.logger&&t.logger.info(e.id+"号优先弹幕将于2秒后再次请求注册"),n.start+=2e3,!0)});else{c=-1;for(var D=0,B=o.length-s;D<=B;D++){l=!0;for(var q=D;q<D+s;q++)if(o[q].bookId[e.mode]){l=!1;break}if(l){c=D;break}}if(-1!==c){for(var R=c;R<c+s;R++)o[R].bookId[e.mode]=e.id,t.logger&&t.logger.info(R+"号轨道被"+e.id+"号优先弹幕预定");n.player&&n.bulletBtn.main.data.some(function(n){return n.id===e.id&&(t.logger&&t.logger.info(e.id+"号优先弹幕将于2秒后再次请求注册"),n.start+=2e3,n.bookChannelId=[c,s],t.logger&&t.logger.info("".concat(e.id,"号优先弹幕预定了").concat(c,"~").concat(c+s-1,"号轨道")),!0)})}}return{result:!1,message:"no surplus will right"}}},{key:"removeBullet",value:function(e){this.logger&&this.logger.info("removeBullet ".concat(e.options.txt||"[DOM Element]"));for(var t,n=this.channels,o=e.channel_id,i=o[0],r=o[0]+o[1];i<r;i++)!function(o,i){if(t=n[o]){t.operating[e.mode]=!0;var r=-1;t.queue[e.mode].some(function(t,n){return t.id===e.id&&(r=n,!0)}),r>-1&&t.queue[e.mode].splice(r,1),t.operating[e.mode]=!1}}(i,0);e.options.loop&&this.danmu.bulletBtn.main.playedData.push(e.options)}},{key:"resizeSync",value:function(){this.resize(!0)}},{key:"_initChannels",value:function(){if(this.danmu&&this.danmu.config){var e=this.danmu.config,t=e.channelSize||(/mobile/gi.test(navigator.userAgent)?10:12);if(e.area){var n,o=e.area,i=o.lines,r=o.start,s=o.end;if("number"==typeof i&&i>=0&&Number.isInteger(i))n=i,"b2t"===this.direction?this.width=n*t:this.height=n*t;else if(r>=0&&s>=r){var a=s-r;"b2t"===this.direction?this.width=Math.floor(this.width*a):this.height=Math.floor(this.height*a)}}d(n)||(n="b2t"===this.direction?Math.floor(this.width/t):Math.floor(this.height/t));for(var l=[],c=0;c<n;c++)l[c]={id:c,queue:{scroll:[],top:[],bottom:[]},operating:{scroll:!1,top:!1,bottom:!1},bookId:{}};return{channelSize:t,channelCount:n,channels:l}}}},{key:"resize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.logger&&this.logger.info("resize");var t=this;function n(e,t){e[t]={id:t,queue:{scroll:[],top:[],bottom:[]},operating:{scroll:!1,top:!1,bottom:!1},bookId:{}}}function o(){var e=t.danmu,o=e.container,i=e.bulletBtn;t.container=o,t.updatePos(),t._cancelResizeTimer(),i.main.data&&i.main.data.forEach(function(e){e.bookChannelId&&(delete e.bookChannelId,t.logger&&t.logger.info("resize导致"+e.id+"号优先弹幕预定取消"))}),t.logger&&t.logger.info("resize导致所有轨道恢复正常使用"),t.width=t.containerWidth,t.height=t.containerHeight;var r=t._initChannels(),s=r.channelSize,a=r.channels;if(t.channels)if(t.channels.length<=a.length){for(var l=function(e){["scroll","top","bottom"].forEach(function(t){a[e].queue[t].forEach(function(e){e.resized=!1})})},c=0;c<t.channels.length;c++)n(a,c),function(e){["scroll","top"].forEach(function(n){t.channels[e].queue[n].forEach(function(t){t.el&&a[e].queue[n].push(t)})})}(c),function(e){t.channels[e].queue.bottom.forEach(function(n){if(n.el&&(a[e+a.length-t.channels.length].queue.bottom.push(n),n.channel_id[0]+n.channel_id[1]-1===e)){var o=[].concat(n.channel_id);n.channel_id=[o[0]-t.channels.length+a.length,o[1]],n.top=n.channel_id[0]*s,t.danmu.config.area&&t.danmu.config.area.start&&(n.top+=t.containerHeight*t.danmu.config.area.start),n.topInit()}})}(c);for(var u=0;u<a.length;u++)l(u);t.channels=a,"b2t"===t.direction?t.channelWidth=s:t.channelHeight=s}else!function(e,o){for(var i=function(i){n(e,i),s.forEach(function(n){if("top"===n&&i>Math.floor(e.length/2));else if("bottom"===n&&i<=Math.floor(e.length/2));else{var r="bottom"===n?i-e.length+t.channels.length:i;t.channels[r].queue[n].forEach(function(s,a){if(s.el){if(e[i].queue[n].push(s),"bottom"===n&&s.channel_id[0]+s.channel_id[1]-1===r){var l=[].concat(s.channel_id);s.channel_id=[l[0]-t.channels.length+e.length,l[1]],s.top=s.channel_id[0]*o,t.danmu.config.area&&t.danmu.config.area.start&&(s.top+=t.containerHeight*t.danmu.config.area.start),s.topInit()}t.channels[r].queue[n].splice(a,1)}})}})},r=function(t){s.forEach(function(n){e[t].queue[n].forEach(function(e){e.resized=!1})})},s=["scroll","top","bottom"],a=0;a<e.length;a++)i(a);for(var l=0;l<e.length;l++)r(l);t.channels=e,"b2t"===t.direction?t.channelWidth=o:t.channelHeight=o}(a,s);t.resizing=!1}t.resizing||(t.resizing=!0,e?o():(this._cancelResizeTimer(),this.resizeId=requestAnimationFrame(o)))}},{key:"_cancelResizeTimer",value:function(){this.resizeId&&(cancelAnimationFrame(this.resizeId),this.resizeId=null)}}],function(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}(n.prototype,t),n}(a);function x(e){return(x=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function j(e,t){return(j=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function C(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(C=function(){return!!e})()}var O=function(e){var t;if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");function n(e){var t,o;if(!(this instanceof n))throw TypeError("Cannot call a class as a function");return o=x(o=n),(t=function(e,t){var n;if(t&&("object"==((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)||"function"==typeof t))return t;if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,C()?Reflect.construct(o,[],x(this).constructor):o.apply(this,void 0))).setLogger("main"),t.danmu=e,t.container=e.container,t.channel=new k(e),t.data=[].concat(e.config.comments),t.playedData=[],t.queue=[],t.timer=null,t.playRate=1,t.retryStatus="normal",t.interval=e.config.interval,t._status="idle",t._events=[],t._bindEvents(),t}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),e&&j(n,e),t=[{key:"status",get:function(){return this._status}},{key:"destroy",value:function(){for(var e in this.logger&&this.logger.info("destroy"),this._unbindEvents(),this._cancelTick(),this.channel&&this.channel.destroy(),this.data=[],this)delete this[e]}},{key:"_bindEvents",value:function(){var e=this,t=this.danmu,n=this.container;this._unbindEvents(),this._events.push([t,"bullet_remove",function(t){var n=t.bullet,o=e.data,i=e.queue;i.some(function(e,t){return e.id===n.id&&(i.splice(t,1),!0)}),o.some(function(e){return e.id===n.id&&(e.attached_=!1,!0)})}]),this._events.push([n,"transitionend",function(t){var n=e._getBulletByEvt(t);n&&(n.status="end",n.remove(!1))}]),(t.config.mouseControl||t.config.mouseEnterControl)&&this._events.push([n,"mouseover",function(t){var n,o=e.danmu;o&&(!o.mouseControl||!o.config.mouseControlPause)&&(n=e._getBulletByEvt(t))&&"waiting"!==n.status&&"end"!==n.status&&o.emit("bullet_hover",{bullet:n,event:t})}]),this._events.forEach(function(e){e[0].addEventListener?e[0].addEventListener(e[1],e[2],!1):e[0].on&&e[0].on(e[1],e[2])})}},{key:"_unbindEvents",value:function(){this._events.length&&(this._events.forEach(function(e){e[0].removeEventListener?e[0].removeEventListener(e[1],e[2],!1):e[0].off&&e[0].off(e[1],e[2])}),this._events=[])}},{key:"_cancelTick",value:function(){this.handleTimer&&(clearTimeout(this.handleTimer),this.handleTimer=null)}},{key:"_startTick",value:function(){var e=this;e.retryStatus="normal",e._cancelTick(),e.sortData(),!function t(){"closed"===e._status&&"stop"===e.retryStatus?e._cancelTick():("playing"===e._status&&(e.readData(),e.dataHandle()),("stop"!==e.retryStatus||"paused"===e._status)&&(e.handleTimer=setTimeout(t,250)))}()}},{key:"start",value:function(){this.logger&&this.logger.info("start"),"playing"!==this._status&&(this._status="playing",this.queue=[],this.container.innerHTML="",this.channel.reset(),this._startTick())}},{key:"stop",value:function(){this.logger&&this.logger.info("stop"),"closed"!==this._status&&(this._status="closed",this.retryStatus="stop",this.queue=[],this.container&&(this.container.innerHTML=""),this.channel&&this.channel.reset(),this._cancelTick())}},{key:"clear",value:function(){this.logger&&this.logger.info("clear"),this.channel&&this.channel.reset(),this.data=[],this.queue=[],this.container&&(this.container.innerHTML="")}},{key:"play",value:function(){var e=this;if("closed"===this._status){this.logger&&this.logger.info("play ignored");return}this.logger&&this.logger.info("play"),this._status="playing";var t=this.channel.channels;t&&t.length>0&&["scroll","top","bottom"].forEach(function(n){e.queue.forEach(function(e){e.startMove(),e.resized=!0});for(var o=0;o<t.length;o++)t[o].queue[n].forEach(function(e){e.resized=!1})}),this._startTick()}},{key:"pause",value:function(){if("closed"===this._status){this.logger&&this.logger.info("pause ignored");return}this.logger&&this.logger.info("pause"),this._status="paused",this._cancelTick();var e=this.channel.channels;e&&e.length>0&&this.queue.forEach(function(e){e.pauseMove()})}},{key:"dataHandle",value:function(){"paused"!==this._status&&"closed"!==this._status&&this.queue.length&&this.queue.forEach(function(e){"waiting"===e.status&&e.startMove()})}},{key:"readData",value:function(){var e=this.danmu,t=this.interval,n=this.channel,o=e.player;if(e.isReady&&e.main){if(o){var i=o.currentTime?Math.floor(1e3*o.currentTime):0;s=this.data.filter(function(n){return!n.start&&0>e.hideArr.indexOf(n.mode)&&(!n.color||0>e.hideArr.indexOf("color"))&&(n.start=i),!n.attached_&&0>e.hideArr.indexOf(n.mode)&&(!n.color||0>e.hideArr.indexOf("color"))&&n.start-t<=i&&i<=n.start+t}),e.config.highScorePriority&&s.sort(function(e,t){return t.prior&&!e.prior||(t.score||-1)-(e.score||-1)}),e.live&&(this.data=[])}else 0===(s=this.data.splice(0,1)).length&&(s=this.playedData.splice(0,1));if(s.length>0&&n.checkAvailableTrack(s[0].mode)){n.updatePos();for(var r,s,a,c=0,u=0;u<s.length;u++)if(a=s[u],this.forceDuration&&this.forceDuration!==a.duration&&(a.duration=this.forceDuration),(r=new y(e,a)).bulletCreateFail)if(0===c)break;else c--;else if(r.attach(),a.attached_=!0,n.addBullet(r).result)this.queue.push(r),r.topInit(),c=0;else{for(var h in r.detach(),r)l.call(r,h)&&delete r[h];if(r=null,a.attached_=!1,a.noDiscard&&(a.prior?this.data.unshift(a):this.data.push(a)),0===c)break;c--}}}}},{key:"sortData",value:function(){this.data.sort(function(e,t){return(e.start||-1)-(t.start||-1)})}},{key:"keepPoolWatermark",value:function(){var e=this.danmu,t=e.config,n=e.player,o=this.data,i=[],r=0;if("number"==typeof t.maxCommentsLength&&o.length>t.maxCommentsLength){r=o.length-t.maxCommentsLength;for(var s,a=0;a<r;a++)(s=o[a]).prior&&!s.attached_&&i.push(o[a])}else if(t.dropStaleComments&&n&&n.currentTime){var l=Math.floor(1e3*n.currentTime)-t.interval;if(l>0){for(var c,u=0;u<o.length;u++)if((c=o[u]).prior&&!c.attached_&&i.push(o[u]),c.start>l){r=u;break}}}r>0&&(o.splice(0,r),this.data=i.concat(o))}},{key:"_getBulletByEvt",value:function(e){for(var t,n,o=e.target||e.srcElement,i=this.queue,r=0;r<i.length;r++)if((n=i[r])&&n.el&&(n.el===o||n.el.contains(o))){t=n;break}return t}}],function(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}(n.prototype,t),n}(a);function w(e){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function S(e,t){return(S=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function E(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(E=function(){return!!e})()}var T=function(e){var t;if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");function n(e){var t,o;if(!(this instanceof n))throw TypeError("Cannot call a class as a function");return o=w(o=n),(t=function(e,t){var n;if(t&&("object"==((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)||"function"==typeof t))return t;if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(this,E()?Reflect.construct(o,[],w(this).constructor):o.apply(this,void 0))).setLogger("control"),t.danmu=e,t.main=new O(e),e.config.defaultOff||t.main.start(),t}return n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),e&&S(n,e),t=[{key:"createSwitch",value:function(){var e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return this.logger&&this.logger.info("createSwitch"),this.switchBtn=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"div",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=document.createElement(e);return i.className=o,i.innerHTML=t,Object.keys(n).forEach(function(t){var o=n[t];"video"===e||"audio"===e?o&&i.setAttribute(t,o):i.setAttribute(t,o)}),i}("dk-switch",'<span class="txt">弹</span>',{},"danmu-switch ".concat(e?"danmu-switch-active":"")),this.switchBtn}},{key:"destroy",value:function(){for(var e in this.logger&&this.logger.info("destroy"),this.main.destroy(),this)l.call(this,e)&&delete this[e]}}],function(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}(n.prototype,t),n}(a),z=function(){var e;function t(e){if(!(this instanceof t))throw TypeError("Cannot call a class as a function");e={initDOM:function(){return document.createElement("div")},initSize:10},this.init(e)}return e=[{key:"init",value:function(e){this.idleList=[],this.usingList=[],this._id=0,this.options=e,this._expand(e.initSize)}},{key:"use",value:function(){this.idleList.length||this._expand(1);var e=this.idleList.shift();return this.usingList.push(e),e}},{key:"unused",value:function(e){var t=this.usingList.indexOf(e);t<0||(this.usingList.splice(t,1),e.style.opacity=0,this.idleList.push(e))}},{key:"_expand",value:function(e){for(var t=0;t<e;t++)this.idleList.push(this.options.initDOM(this._id++))}},{key:"destroy",value:function(){for(var e=0;e<this.idleList.length;e++)this.idleList[e].innerHTML="",this.idleList[e].textcontent="",this.clearElementStyle(this.idleList[e]);for(var t=0;t<this.usingList.length;t++)this.usingList[t].innerHTML="",this.usingList[t].textcontent="",this.clearElementStyle(this.usingList[t]);for(var n in this)l.call(this,n)&&delete this[n]}},{key:"clearElementStyle",value:function(e){var t="undefined"!=typeof window?window.navigator.userAgent:null;t&&(t.indexOf("MSIE ")>-1||t.indexOf("Trident/")>-1?f(e,"transform","none"):e.setAttribute("style",""))}}],function(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}(t.prototype,e),t}(),M=new(function(){var e;function t(){var e=this;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");if(this.__handlers=[],"undefined"!=typeof ResizeObserver)try{this.observer=new ResizeObserver(function(e,t){var n=this,o=0;return function(){for(var i=arguments.length,r=Array(i),s=0;s<i;s++)r[s]=arguments[s];clearTimeout(o),o=setTimeout(function(){return e.apply(n,r)},t)}}(function(t){e.__trigger(t)},100))}catch(e){}}return e=[{key:"addObserver",value:function(e,t){if(this.observer&&e){this.observer&&this.observer.observe(e);for(var n=this.__handlers,o=-1,i=0;i<n.length;i++)n[i]&&e===n[i].target&&(o=i);o>-1?this.__handlers[o].handler.push(t):this.__handlers.push({target:e,handler:[t]})}}},{key:"unObserver",value:function(e){if(e){var t=-1;this.__handlers.map(function(n,o){e===n.target&&(t=o)}),this.observer&&this.observer.unobserve(e),t>-1&&this.__handlers.splice(t,1)}}},{key:"destroyObserver",value:function(){this.observer&&this.observer.disconnect(),this.observer=null,this.__handlers=null}},{key:"__runHandler",value:function(e){for(var t=this.__handlers,n=0;n<t.length;n++)if(t[n]&&e===t[n].target){t[n].handler&&t[n].handler.map(function(e){try{e()}catch(e){console.error(e)}});break}}},{key:"__trigger",value:function(e){var t=this;e.map(function(e){t.__runHandler(e.target)})}}],function(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}(t.prototype,e),t}());function P(e){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function I(e,t){var n;if(t&&("object"==((n=t)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)||"function"==typeof t))return t;if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function L(e,t){return(L=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function D(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(D=function(){return!!e})()}var B=function(e){var n;if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");function o(e){if(!(this instanceof o))throw TypeError("Cannot call a class as a function");n=P(n=o),(i=I(this,D()?Reflect.construct(n,[],P(this).constructor):n.apply(this,void 0))).setLogger("danmu"),i.logger&&i.logger.info("danmu.js version: ".concat("1.2.1"));var n,i,r=i.config={overlap:!1,area:{start:0,end:1,lines:void 0},hooks:void 0,live:!1,comments:[],direction:"r2l",needResizeObserver:!1,dropStaleComments:!1,channelSize:void 0,maxCommentsLength:void 0,bulletOffset:void 0,interval:2e3,highScorePriority:!0,chaseEffect:!0};if(c(r,e),t()(i),i.globalHooks={},r.hooks&&i.hooks(r.hooks),i.hideArr=[],i.recycler=new z,i.freezeId=null,r.comments.forEach(function(e){e.duration=e.duration?e.duration:5e3,e.mode||(e.mode="scroll")}),i.container=r.container&&1===r.container.nodeType?r.container:null,!i.container)return i.emit("error","container id can't be empty"),I(i,!1);if(r.containerStyle){var s=r.containerStyle;Object.keys(s).forEach(function(e){i.container.style[e]=s[e]})}var a=i.container,l="danmu";return a.classList?l.replace(/(^\s+|\s+$)/g,"").split(/\s+/g).forEach(function(e){e&&a.classList.add(e)}):(a.classList?Array.prototype.some.call(a.classList,function(e){return e===l}):a.className.match(RegExp("(\\s|^)"+l+"(\\s|$)")))||(a.className+=" "+l),i.live=r.live,i.player=r.player,i.direction=r.direction,i.bulletBtn=new T(i),i.main=i.bulletBtn.main,i.isReady=!0,i.emit("ready"),i.logger&&i.logger.info("ready"),i.addResizeObserver(),i}return o.prototype=Object.create(e&&e.prototype,{constructor:{value:o,writable:!0,configurable:!0}}),e&&L(o,e),n=[{key:"status",get:function(){return this.main.status}},{key:"state",get:function(){var e=this.main;return{status:e.status,comments:e.data,bullets:e.queue,displayArea:e.channel.getRealOccupyArea()}}},{key:"containerPos",get:function(){return this.main.channel.containerPos}},{key:"hooks",value:function(e){c(this.globalHooks,e)}},{key:"addResizeObserver",value:function(){var e,t=this;this.config.needResizeObserver&&this.container&&(e=this.container,M.addObserver(e,function(){t.logger&&t.logger.info("needResizeObserver"),t.resize()}))}},{key:"start",value:function(){this.logger&&this.logger.info("start"),this.main&&this.main.start()}},{key:"pause",value:function(){this.logger&&this.logger.info("pause"),this.main&&this.main.pause()}},{key:"play",value:function(){this.logger&&this.logger.info("play"),this.main&&this.main.play()}},{key:"stop",value:function(){this.logger&&this.logger.info("stop"),this.main&&this.main.stop()}},{key:"clear",value:function(){this.logger&&this.logger.info("clear"),this.main&&this.main.clear()}},{key:"destroy",value:function(){var e;for(var t in e=this.container,M.unObserver(e,void 0),this.logger&&this.logger.info("destroy"),this.stop(),this.bulletBtn&&this.bulletBtn.destroy(),this.recycler&&this.recycler.destroy(),this)delete this[t];this.emit("destroy")}},{key:"sendComment",value:function(e){var t=this.main,n=this.logger;n&&n.info("sendComment: ".concat(e.txt||"[DOM Element]")),t&&(e.duration||(e.duration=15e3),e&&e.id&&e.duration&&(e.el||e.elLazyInit||e.txt)&&(e.duration=e.duration?e.duration:5e3,e.style||(e.style={opacity:void 0,fontSize:void 0}),e.style&&(this.opacity&&this.opacity!==e.style.opacity&&(e.style.opacity=this.opacity),this.fontSize&&this.fontSize!==e.style.fontSize&&(e.style.fontSize=this.fontSize)),e.prior||e.realTime?(t.data.unshift(e),e.realTime&&(t.readData(),t.dataHandle())):t.data.push(e),t.sortData(),t.keepPoolWatermark()))}},{key:"setCommentID",value:function(e,t){var n=this;this.logger&&this.logger.info("setCommentID: oldID ".concat(e," newID ").concat(t)),e&&t&&(this.main.data.some(function(n){return n.id===e&&(n.id=t,!0)}),this.main.queue.some(function(o){return o.id===e&&(o.id=t,o.pauseMove(),"paused"!==n.main.status&&o.startMove(),!0)}))}},{key:"setCommentDuration",value:function(e,t){var n=this;this.logger&&this.logger.info("setCommentDuration: id ".concat(e," duration ").concat(t)),e&&t&&(t=t||5e3,this.main.data.some(function(n){return n.id===e&&(n.duration=t,!0)}),this.main.queue.some(function(o){return o.id===e&&(o.duration=t,o.pauseMove(),"paused"!==n.main.status&&o.startMove(),!0)}))}},{key:"setCommentLike",value:function(e,t){this.logger&&this.logger.info("setCommentLike: id ".concat(e," like ").concat(t)),e&&t&&(this.main.data.some(function(n){return n.id===e&&(n.like=t,!0)}),this.main.queue.some(function(n){return n.id===e&&(n.pauseMove(),n.setLikeDom(t.el,t.style),"paused"!==n.danmu.main.status&&n.startMove(),!0)}))}},{key:"restartComment",value:function(e){if(this.logger&&this.logger.info("restartComment: id ".concat(e)),e){var t=this.main;this._releaseCtrl(e),"closed"!==t.status&&t.queue.some(function(n){return n.id===e&&("paused"!==t.status?n.startMove(!0):n.status="paused",!0)})}}},{key:"_releaseCtrl",value:function(e){this.freezeId&&e===this.freezeId&&(this.mouseControl=!1,this.freezeId=null)}},{key:"_freezeCtrl",value:function(e){this.mouseControl=!0,this.freezeId=e}},{key:"freezeComment",value:function(e){this.logger&&this.logger.info("freezeComment: id ".concat(e)),e&&(this._freezeCtrl(e),this.main.queue.some(function(t){return t.id===e&&(t.status="forcedPause",t.pauseMove(),t.el&&t.el.style&&f(t.el,"zIndex",10),!0)}))}},{key:"removeComment",value:function(e){if(this.logger&&this.logger.info("removeComment: id ".concat(e)),e){var t=this.main;this._releaseCtrl(e),t.queue=t.queue.filter(function(t){return t.id!==e||(t.remove(),!1)}),t.data=t.data.filter(function(t){return t.id!==e})}}},{key:"updateComments",value:function(e){var t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];this.logger&&this.logger.info("updateComments: ".concat(e.length,", isClear ").concat(t));var n=this.main;"boolean"==typeof t&&t&&(n.data=[]),n.data=n.data.concat(e),n.sortData(),n.keepPoolWatermark()}},{key:"setAllDuration",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"scroll",n=arguments.length>1?arguments[1]:void 0,o=!(arguments.length>2)||void 0===arguments[2]||arguments[2];this.logger&&this.logger.info("setAllDuration: mode ".concat(t," duration ").concat(n," force ").concat(o)),n&&(n=n||5e3,o&&(this.main.forceDuration=n),this.main.data.forEach(function(e){t===e.mode&&(e.duration=n)}),this.main.queue.forEach(function(o){t===o.mode&&(o.duration=n,o.pauseMove(),"paused"!==e.main.status&&o.startMove())}))}},{key:"setPlayRate",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"scroll",n=arguments.length>1?arguments[1]:void 0;this.logger&&this.logger.info("setPlayRate: ".concat(n)),d(n)&&n>0&&(this.main.playRate=n,this.main.queue.forEach(function(n){t===n.mode&&(n.pauseMove(),"paused"!==e.main.status&&n.startMove())}))}},{key:"setOpacity",value:function(e){this.logger&&this.logger.info("setOpacity: opacity ".concat(e)),this.container&&(this.container.style.opacity=e)}},{key:"setFontSize",value:function(e,t){var n=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{reflow:!0};this.logger&&this.logger.info("setFontSize: size ".concat(e," channelSize ").concat(t)),this.fontSize="".concat(e,"px"),e&&(this.main.data.forEach(function(e){e.style&&(e.style.fontSize=n.fontSize)}),this.main.queue.forEach(function(e){e.options.style||(e.options.style={}),e.options.style.fontSize=n.fontSize,e.setFontSize(n.fontSize),t&&(e.top=e.channel_id[0]*t,e.topInit())})),t&&(this.config.channelSize=t,o.reflow&&this.main.channel.resizeSync())}},{key:"setArea",value:function(e){this.logger&&this.logger.info("setArea: area ".concat(e)),this.config.area=e,!1!==e.reflow&&this.main.channel.resizeSync()}},{key:"hide",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"scroll";this.logger&&this.logger.info("hide: mode ".concat(e)),0>this.hideArr.indexOf(e)&&this.hideArr.push(e),this.main.queue.filter(function(t){return e===t.mode||"color"===e&&t.color}).forEach(function(e){return e.remove()})}},{key:"show",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"scroll";this.logger&&this.logger.info("show: mode ".concat(e));var t=this.hideArr.indexOf(e);t>-1&&this.hideArr.splice(t,1)}},{key:"setDirection",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"r2l";this.logger&&this.logger.info("setDirection: direction ".concat(e)),this.direction=e,this.emit("changeDirection",e)}},{key:"resize",value:function(){this.logger&&this.logger.info("resize"),this.emit("channel_resize")}}],function(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}(o.prototype,n),o}(a),q=n("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),R=n.n(q),H=n("./node_modules/style-loader/dist/runtime/styleDomAPI.js"),N=n.n(H),F=n("./node_modules/style-loader/dist/runtime/insertBySelector.js"),W=n.n(F),V=n("./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js"),U=n.n(V),Y=n("./node_modules/style-loader/dist/runtime/insertStyleElement.js"),Z=n.n(Y),X=n("./node_modules/style-loader/dist/runtime/styleTagTransform.js"),J=n.n(X),$=n("./node_modules/css-loader/dist/cjs.js!./node_modules/sass-loader/dist/cjs.js!./src/style/index.scss"),G={};G.styleTagTransform=J(),G.setAttributes=U(),G.insert=W().bind(null,"head"),G.domAPI=N(),G.insertStyleElement=Z(),R()($.A,G),$.A&&$.A.locals&&$.A.locals}(),o}()});
//# sourceMappingURL=index.js.map